<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSI Annual Programme 2023-24 Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .tab-active {
            border-bottom: 2px solid #3B82F6;
            color: #2563EB;
            background-color: #EFF6FF;
        }
        .tab-inactive {
            border-bottom: 2px solid transparent;
            color: #6B7280;
        }
        .tab-inactive:hover {
            color: #1F2937;
            background-color: #F9FAFB;
        }
        .pie-slice {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .pie-slice:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto p-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                GSI Annual Programme 2023-24 Dashboard
            </h1>
            <p class="text-gray-600 mb-4">
                Interactive visualization of Geological Survey of India missions and programmes
            </p>
            
            <!-- Controls -->
            <div class="flex flex-wrap gap-4 items-center">
                <div class="flex-1 min-w-64">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Search programmes..."
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                </div>
                <button
                    onclick="showSaveModal()"
                    class="flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"
                >
                    üíæ Save Data
                </button>
                <button
                    onclick="showImportModal()"
                    class="flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors"
                >
                    üìÅ Import Data
                </button>
            </div>
        </div>

        <!-- Horizontal Tabs -->
        <div class="max-w-7xl mx-auto">
            <div class="flex overflow-x-auto" id="tabContainer">
                <!-- Tabs will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto p-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Pie Chart -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold mb-4 text-center">Programme Distribution</h3>
                    <div class="flex items-center justify-center">
                        <div class="relative">
                            <svg width="200" height="200" class="transform -rotate-90" id="pieChart">
                                <!-- Pie slices will be generated by JavaScript -->
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-gray-800" id="totalProgrammes">966</div>
                                    <div class="text-sm text-gray-600">Total</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Legend -->
                    <div class="mt-4 space-y-2" id="legend">
                        <!-- Legend items will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Mission Content -->
            <div class="lg:col-span-3">
                <div class="bg-white rounded-lg shadow-lg" id="missionContent">
                    <!-- Mission content will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Save Modal -->
    <div id="saveModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-96">
            <h3 class="text-lg font-semibold mb-4">Save Programme Data to Computer</h3>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    üíæ File Name
                </label>
                <input
                    type="text"
                    id="saveFileNameInput"
                    placeholder="Enter filename (e.g., gsi-dashboard-data)"
                    value="gsi-dashboard-data"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <p class="text-xs text-gray-500 mt-1">File will be saved as .json format</p>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    üìç Project Location (Optional)
                </label>
                <input
                    type="text"
                    id="saveProjectLocationInput"
                    placeholder="Enter project location (e.g., Mumbai Survey Site)"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <p class="text-xs text-gray-500 mt-1">This will be stored inside the data file for reference</p>
            </div>
            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-700">
                    <strong>üí° Save Location:</strong> File will be saved to your default Downloads folder. You can move it to any location after saving.
                </p>
            </div>
            <div class="flex gap-2 justify-end">
                <button
                    onclick="hideSaveModal()"
                    class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"
                >
                    Cancel
                </button>
                <button
                    onclick="saveDataToComputer()"
                    class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                >
                    üíæ Save to Computer
                </button>
                <button
                    onclick="saveDataAdvanced()"
                    class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                    title="Choose specific folder (Modern browsers only)"
                >
                    üìÅ Choose Folder
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-96">
            <h3 class="text-lg font-semibold mb-4">Import Programme Data</h3>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Select JSON file to import
                </label>
                <input
                    type="file"
                    id="importFileInput"
                    accept=".json"
                    onchange="importData(event)"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <p class="text-xs text-gray-500 mt-2">
                    üìÑ Import files previously saved from this dashboard.<br>
                    üîç The file should be in JSON format with .json extension.
                </p>
            </div>
            <div class="mb-4 p-3 bg-yellow-50 rounded-lg">
                <p class="text-sm text-yellow-700">
                    <strong>üí° Tip:</strong> Importing will replace your current edits. Make sure to save your current work first if needed.
                </p>
            </div>
            <div class="flex gap-2 justify-end">
                <button
                    onclick="hideImportModal()"
                    class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"
                >
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mission data
        const missionsData = {
            'mission-1': {
                title: 'Mission-I: Baseline Geoscience Data Generation',
                shortTitle: 'Baseline Geoscience',
                icon: 'üåç',
                color: '#3B82F6',
                programmes: 298,
                subMissions: {
                    'mission-1a': {
                        title: 'Mission-IA: Ground & Marine Surveys',
                        objective: 'Generate baseline geological data through comprehensive ground mapping, marine surveys, and geophysical mapping of the Indian landmass and EEZ.',
                        methodology: 'Systematic Geological Mapping (SGM), Specialized Thematic Mapping (STM), National Geochemical Mapping (NGCM), National Geophysical Mapping (NGPM), Marine & Coastal Surveys',
                        instruments: 'Ground gravity-magnetic survey instruments, Marine vessels (RV Samudra Ratnakar, RV Samudra Kaustubh, RV Samudra Shaudhikama), GPS equipment, Geochemical analysis equipment',
                        programmes: [
                            'Specialized Thematic Mapping (STM) - 86 projects',
                            'National Geochemical Mapping (NGCM) - 147 projects', 
                            'National Geophysical Mapping (NGPM) - 34 projects',
                            'Marine Surveys - 19 projects'
                        ]
                    },
                    'mission-1b': {
                        title: 'Mission-IB: Remote Sensing & Aerial Surveys',
                        objective: 'Conduct aero-geophysical surveys and remote sensing studies to identify concealed mineral resources and geological structures.',
                        methodology: 'Airborne geophysical surveys, Hyperspectral remote sensing, Multispectral analysis, National Aero-Geophysical Mapping Program (NAGMP)',
                        instruments: 'Twin Otter Airborne Survey System (TOASS), AVIRIS NG hyperspectral data, ASTER multispectral data, Spectro-radiometer',
                        programmes: [
                            'Hyperspectral/Multispectral Survey - 12 projects',
                            'NAGMP surveys covering 0.280 million sq. km',
                            'Photo Geology & Remote Sensing studies'
                        ]
                    }
                }
            },
            'mission-2': {
                title: 'Mission-II: Natural Resource Assessment',
                shortTitle: 'Natural Resources',
                icon: 'üîç',
                color: '#10B981',
                programmes: 318,
                subMissions: {
                    'mission-2a': {
                        title: 'Mission-IIA: Mineral Resource Assessment',
                        objective: 'Explore and assess mineral resources including ferrous, non-ferrous, precious, strategic, industrial, and fertilizer minerals across India.',
                        methodology: 'G2/G3/G4 stage exploration as per UNFC, Regional Mineral Targeting (RMT), Large Scale Mapping (LSM), drilling programs',
                        instruments: 'Drilling equipment, Geophysical logging tools, XRF analyzers, Core analysis equipment, Sample collection tools',
                        programmes: [
                            'G4 stage exploration - 183 items',
                            'G3 stage exploration - 74 items', 
                            'G2 stage exploration - 11 items',
                            'Regional Mineral Targeting (RMT) - 15 items',
                            'R&D/RP projects - 7 items'
                        ]
                    },
                    'mission-2b': {
                        title: 'Mission-IIB: Natural Energy Resources',
                        objective: 'Assess coal, lignite, shale gas, and geothermal energy resources to support India\'s energy security.',
                        methodology: 'Coal exploration, Shale gas assessment, Geothermal energy evaluation, Offshore mineral investigation',
                        instruments: 'Coal analysis equipment, Geothermal monitoring instruments, Marine exploration vessels, Core drilling rigs',
                        programmes: [
                            'Coal exploration - 6 G3 projects, 6 G4 projects',
                            'Geothermal energy - 3 projects',
                            'Marine mineral investigation - 12 projects',
                            'Research projects - 1 item'
                        ]
                    }
                }
            },
            'mission-3': {
                title: 'Mission-III: Geoinformatics',
                shortTitle: 'Geoinformatics',
                icon: 'üíæ',
                color: '#8B5CF6',
                programmes: 55,
                subMissions: {
                    'mission-3a': {
                        title: 'Mission-IIIA: Data Repository & IT Infrastructure',
                        objective: 'Develop and maintain comprehensive geoscientific databases and IT infrastructure for data management and dissemination.',
                        methodology: 'Database creation, IT infrastructure development, OCBIS portal management, Legacy data digitization',
                        instruments: 'Servers, Database management systems, GIS software, Web technologies, Cloud infrastructure',
                        programmes: [
                            'Legacy Borehole Data Repository (LBDR) creation',
                            'OCBIS portal maintenance with 13 Core Modules',
                            'Bhukosh geospatial data portal - 114,406 datasets downloaded'
                        ]
                    },
                    'mission-3b': {
                        title: 'Mission-IIIB: Publication & Library',
                        objective: 'Publish scientific literature, maintain libraries, and disseminate geoscientific knowledge to stakeholders.',
                        methodology: 'Scientific publication, Report compilation, Journal publication, Library management',
                        instruments: 'Publishing software, Digital libraries, Printing equipment, Content management systems',
                        programmes: [
                            '26 publications in FS 2022-23',
                            'Indian Journal of Geosciences publication',
                            'Records of GSI publication',
                            'Special Publications and Bulletins'
                        ]
                    },
                    'mission-3c': {
                        title: 'Mission-IIIC: Map & Data Integration',
                        objective: 'Compile geological maps, integrate multi-thematic data, and create comprehensive geospatial databases.',
                        methodology: 'Map compilation, GIS database creation, Data integration, Spatial modeling',
                        instruments: 'GIS software (ArcGIS), CAD systems, Spatial analysis tools, Map production equipment',
                        programmes: [
                            'National Geoscience Data Repository (NGDR) development',
                            'District Resource Maps compilation',
                            'Geological Quadrangle Maps preparation',
                            'Mineral Belt Maps creation'
                        ]
                    }
                }
            },
            'mission-4': {
                title: 'Mission-IV: Fundamental & Multidisciplinary Geosciences',
                shortTitle: 'Multidisciplinary',
                icon: 'üî¨',
                color: '#F59E0B',
                programmes: 140,
                subMissions: {
                    'mission-4a': {
                        title: 'Mission-IVA: Geotechnical & Geohazards Management',
                        objective: 'Conduct geotechnical studies for infrastructure projects and develop landslide early warning systems.',
                        methodology: 'Landslide susceptibility mapping, Seismic studies, Engineering geology assessments, GPS monitoring',
                        instruments: 'GPS stations, Seismometers, Geotechnical testing equipment, InSAR, 3D-Terrestrial Laser Scanner',
                        programmes: [
                            'Landslide Early Warning System (LEWS) development',
                            'National Landslide Susceptibility Mapping - 4.3 lakh sq. km covered',
                            'Seismo-Geodetic observatories - 34 permanent GPS stations',
                            'Engineering geology for major projects'
                        ]
                    },
                    'mission-4b': {
                        title: 'Mission-IVB: Climate Change & Environmental Studies',
                        objective: 'Study climate change impacts, conduct polar research, and assess environmental geology issues.',
                        methodology: 'Glaciological studies, Polar expeditions, Environmental contamination assessment, Medical geology',
                        instruments: 'Weather monitoring stations, Ice core drilling equipment, Water quality analyzers, Mass spectrometers',
                        programmes: [
                            'Antarctic research at Bharati station',
                            'Glacier mass balance monitoring',
                            'Arsenic/Fluoride contamination studies',
                            'Quaternary geology research'
                        ]
                    },
                    'mission-4c': {
                        title: 'Mission-IVC: Fundamental Geoscience & R&D',
                        objective: 'Conduct fundamental research in petrology, paleontology, geochronology, and advanced geoscientific studies.',
                        methodology: 'Petrological analysis, Fossil studies, Isotope dating, Meteorite research, Experimental petrology',
                        instruments: 'EPMA, SEM-EDX, Mass spectrometers, X-ray diffractometers, Electron microscopes',
                        programmes: [
                            'Petrology research - 19 projects',
                            'Palaeontology studies - 16 projects', 
                            'Geochronology & Isotope Geology - 3 projects',
                            'Meteorite & Planetary Science - 2 projects'
                        ]
                    }
                }
            },
            'mission-5': {
                title: 'Mission-V: Training & Capacity Building',
                shortTitle: 'Training & Capacity',
                icon: 'üéì',
                color: '#EF4444',
                programmes: 155,
                subMissions: {
                    'mission-5a': {
                        title: 'Training & Capacity Building',
                        objective: 'Provide comprehensive training to GSI personnel and external stakeholders in various geoscientific disciplines.',
                        methodology: 'Orientation courses, Thematic training, International programs, Skill development, E-learning',
                        instruments: 'Training laboratories, Field training centers, E-learning platforms, Simulation software',
                        programmes: [
                            'Induction-level (Orientation) Courses - 40',
                            'International Courses (Thematic) - 2',
                            'Basic courses (Thematic) - 27',
                            'Refresher courses (Thematic) - 38',
                            'Advanced courses (Thematic) - 15',
                            'Administrative Courses - 31',
                            'Sponsored programmes - 2'
                        ]
                    }
                }
            }
        };

        // State management
        let activeTab = 'mission-1';
        let expandedSubMissions = {};
        let editedProgrammes = {};

        // Initialize dashboard
        function initDashboard() {
            renderTabs();
            renderPieChart();
            renderMissionContent();
        }

        // Render tabs
        function renderTabs() {
            const tabContainer = document.getElementById('tabContainer');
            tabContainer.innerHTML = '';

            Object.entries(missionsData).forEach(([missionId, mission]) => {
                const tab = document.createElement('button');
                tab.className = `flex items-center gap-2 px-6 py-4 whitespace-nowrap border-b-2 transition-colors ${
                    activeTab === missionId ? 'tab-active' : 'tab-inactive'
                }`;
                tab.onclick = () => switchTab(missionId);
                tab.innerHTML = `
                    <span>${mission.icon}</span>
                    <span class="font-medium">${mission.shortTitle}</span>
                    <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs">
                        ${mission.programmes}
                    </span>
                `;
                tabContainer.appendChild(tab);
            });
        }

        // Switch tab
        function switchTab(missionId) {
            activeTab = missionId;
            renderTabs();
            renderMissionContent();
        }

        // Render pie chart
        function renderPieChart() {
            const pieChart = document.getElementById('pieChart');
            const legend = document.getElementById('legend');
            const total = Object.values(missionsData).reduce((sum, mission) => sum + mission.programmes, 0);
            const colors = ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B', '#EF4444'];
            
            pieChart.innerHTML = '';
            legend.innerHTML = '';

            let currentAngle = 0;
            const radius = 80;
            const centerX = 100;
            const centerY = 100;

            Object.entries(missionsData).forEach(([missionId, mission], index) => {
                const percentage = (mission.programmes / total) * 100;
                const angle = (percentage / 100) * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;
                
                const x1 = centerX + radius * Math.cos((startAngle * Math.PI) / 180);
                const y1 = centerY + radius * Math.sin((startAngle * Math.PI) / 180);
                const x2 = centerX + radius * Math.cos((endAngle * Math.PI) / 180);
                const y2 = centerY + radius * Math.sin((endAngle * Math.PI) / 180);
                
                const largeArcFlag = angle > 180 ? 1 : 0;
                
                const pathData = [
                    `M ${centerX} ${centerY}`,
                    `L ${x1} ${y1}`,
                    `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    'Z'
                ].join(' ');
                
                // Create path element
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index]);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                path.className = 'pie-slice';
                path.onclick = () => switchTab(missionId);
                
                pieChart.appendChild(path);
                
                // Create legend item
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center gap-2 text-sm';
                legendItem.innerHTML = `
                    <div class="w-3 h-3 rounded-full" style="background-color: ${colors[index]}"></div>
                    <span class="flex-1">${mission.shortTitle}</span>
                    <span class="font-medium">${mission.programmes}</span>
                    <span class="text-gray-500">(${percentage.toFixed(1)}%)</span>
                `;
                legend.appendChild(legendItem);
                
                currentAngle += angle;
            });
        }

        // Render mission content
        function renderMissionContent() {
            const missionContent = document.getElementById('missionContent');
            const mission = missionsData[activeTab];

            missionContent.innerHTML = `
                <!-- Mission Header -->
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-xl">${mission.icon}</span>
                        <h2 class="text-2xl font-bold text-gray-800">${mission.title}</h2>
                    </div>
                    <div class="text-gray-600">
                        Total Programmes: <span class="font-semibold text-gray-800">${mission.programmes}</span>
                    </div>
                </div>

                <!-- Sub-missions -->
                <div class="divide-y divide-gray-200" id="subMissionsContainer">
                    ${Object.entries(mission.subMissions).map(([subMissionId, subMission]) => `
                        <div>
                            <div class="flex items-center justify-between p-6 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleSubMission('${subMissionId}')">
                                <h3 class="text-lg font-semibold text-gray-700">${subMission.title}</h3>
                                <span id="chevron-${subMissionId}">${expandedSubMissions[subMissionId] ? '‚åÑ' : '‚åÉ'}</span>
                            </div>
                            <div id="content-${subMissionId}" class="px-6 pb-6 space-y-4 ${expandedSubMissions[subMissionId] ? '' : 'hidden'}">
                                <!-- Objective -->
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                        üìÑ Objective
                                    </h4>
                                    <p class="text-blue-700">${subMission.objective}</p>
                                </div>

                                <!-- Methodology -->
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-800 mb-2 flex items-center gap-2">
                                        üë• Methodology
                                    </h4>
                                    <p class="text-green-700">${subMission.methodology}</p>
                                </div>

                                <!-- Instruments -->
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-800 mb-2 flex items-center gap-2">
                                        üî¨ Instruments Used
                                    </h4>
                                    <p class="text-purple-700">${subMission.instruments}</p>
                                </div>

                                <!-- Programmes (Editable) -->
                                <div class="bg-orange-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-orange-800 mb-2 flex items-center gap-2">
                                        ‚úèÔ∏è Programmes
                                    </h4>
                                    <div class="space-y-2">
                                        ${subMission.programmes.map((programme, index) => `
                                            <div class="flex items-center gap-2">
                                                <span class="text-orange-600 font-medium">${index + 1}.</span>
                                                <input
                                                    type="text"
                                                    value="${editedProgrammes[`${activeTab}-${subMissionId}`]?.[index] || programme}"
                                                    onchange="updateProgramme('${activeTab}', '${subMissionId}', ${index}, this.value)"
                                                    class="flex-1 px-3 py-1 border border-orange-200 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                                />
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Toggle sub-mission
        function toggleSubMission(subMissionId) {
            expandedSubMissions[subMissionId] = !expandedSubMissions[subMissionId];
            const content = document.getElementById(`content-${subMissionId}`);
            const chevron = document.getElementById(`chevron-${subMissionId}`);
            
            if (expandedSubMissions[subMissionId]) {
                content.classList.remove('hidden');
                chevron.textContent = '‚åÑ';
            } else {
                content.classList.add('hidden');
                chevron.textContent = '‚åÉ';
            }
        }

        // Update programme
        function updateProgramme(missionId, subMissionId, index, value) {
            const key = `${missionId}-${subMissionId}`;
            if (!editedProgrammes[key]) {
                editedProgrammes[key] = {};
            }
            editedProgrammes[key][index] = value;
        }

        // Modal functions
        function showSaveModal() {
            document.getElementById('saveModal').classList.remove('hidden');
            document.getElementById('saveModal').classList.add('flex');
        }

        function hideSaveModal() {
            document.getElementById('saveModal').classList.add('hidden');
            document.getElementById('saveModal').classList.remove('flex');
            // Clear inputs
            document.getElementById('saveFileNameInput').value = 'gsi-dashboard-data';
            document.getElementById('saveProjectLocationInput').value = '';
        }

        function showImportModal() {
            document.getElementById('importModal').classList.remove('hidden');
            document.getElementById('importModal').classList.add('flex');
        }

        function hideImportModal() {
            document.getElementById('importModal').classList.add('hidden');
            document.getElementById('importModal').classList.remove('flex');
        }

        // Save data to computer (Downloads folder)
        function saveDataToComputer() {
            const fileName = document.getElementById('saveFileNameInput').value.trim();
            const projectLocation = document.getElementById('saveProjectLocationInput').value.trim();
            
            if (!fileName) {
                alert('Please enter a filename before saving.');
                return;
            }
            
            const dataToSave = {
                programmes: editedProgrammes,
                projectLocation: projectLocation || 'Not specified',
                fileName: fileName,
                timestamp: new Date().toISOString(),
                exportDate: new Date().toLocaleDateString(),
                exportTime: new Date().toLocaleTimeString(),
                missions: missionsData,
                metadata: {
                    totalProgrammes: Object.values(missionsData).reduce((sum, mission) => sum + mission.programmes, 0),
                    exportedBy: 'GSI Dashboard',
                    version: '1.0'
                }
            };
            
            const dataStr = JSON.stringify(dataToSave, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            // Create a clean filename
            const cleanFileName = fileName.replace(/[^a-z0-9]/gi, '-').toLowerCase();
            const dateString = new Date().toISOString().split('T')[0];
            link.download = `${cleanFileName}-${dateString}.json`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`‚úÖ File saved successfully!\n\nFilename: ${link.download}\nLocation: Downloads folder\n\nYou can move this file to any location on your computer.`);
            hideSaveModal();
        }

        // Advanced save with folder picker (Modern browsers only)
        async function saveDataAdvanced() {
            // Check if File System Access API is supported
            if (!('showSaveFilePicker' in window)) {
                alert('‚ö†Ô∏è Advanced save feature not supported in this browser.\nUsing standard download instead...');
                saveDataToComputer();
                return;
            }

            try {
                const fileName = document.getElementById('saveFileNameInput').value.trim();
                const projectLocation = document.getElementById('saveProjectLocationInput').value.trim();
                
                if (!fileName) {
                    alert('Please enter a filename before saving.');
                    return;
                }

                const dataToSave = {
                    programmes: editedProgrammes,
                    projectLocation: projectLocation || 'Not specified',
                    fileName: fileName,
                    timestamp: new Date().toISOString(),
                    exportDate: new Date().toLocaleDateString(),
                    exportTime: new Date().toLocaleTimeString(),
                    missions: missionsData,
                    metadata: {
                        totalProgrammes: Object.values(missionsData).reduce((sum, mission) => sum + mission.programmes, 0),
                        exportedBy: 'GSI Dashboard',
                        version: '1.0'
                    }
                };

                // Show save file picker
                const fileHandle = await window.showSaveFilePicker({
                    suggestedName: `${fileName.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.json`,
                    types: [
                        {
                            description: 'JSON files',
                            accept: {
                                'application/json': ['.json'],
                            },
                        },
                    ],
                });

                // Create writable stream and write data
                const writable = await fileHandle.createWritable();
                await writable.write(JSON.stringify(dataToSave, null, 2));
                await writable.close();

                alert(`‚úÖ File saved successfully to your chosen location!\n\nFilename: ${fileHandle.name}`);
                hideSaveModal();

            } catch (error) {
                if (error.name === 'AbortError') {
                    // User cancelled the save dialog
                    return;
                }
                console.error('Error saving file:', error);
                alert('‚ùå Error saving file. Using standard download instead...');
                saveDataToComputer();
            }
        }

        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Handle both old and new data formats
                        if (importedData.programmes) {
                            editedProgrammes = importedData.programmes;
                        }
                        
                        // Show import success with file details
                        let message = '‚úÖ Data imported successfully!';
                        if (importedData.fileName) {
                            message += `\n\nOriginal filename: ${importedData.fileName}`;
                        }
                        if (importedData.projectLocation && importedData.projectLocation !== 'Not specified') {
                            message += `\nProject location: ${importedData.projectLocation}`;
                        }
                        if (importedData.exportDate) {
                            message += `\nExported on: ${importedData.exportDate} at ${importedData.exportTime}`;
                        }
                        if (importedData.metadata?.totalProgrammes) {
                            message += `\nTotal programmes in file: ${importedData.metadata.totalProgrammes}`;
                        }
                        
                        renderMissionContent();
                        alert(message);
                        hideImportModal();
                        
                        // Reset file input
                        event.target.value = '';
                        
                    } catch (error) {
                        console.error('Import error:', error);
                        alert('‚ùå Error importing data.\n\nPlease check that:\n‚Ä¢ The file is a valid JSON file\n‚Ä¢ The file was exported from this dashboard\n‚Ä¢ The file is not corrupted');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
